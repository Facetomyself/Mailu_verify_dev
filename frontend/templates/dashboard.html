{% extends "base.html" %}

{% block title %}ä»ªè¡¨æ¿ - MailuéªŒè¯ç å¹³å°{% endblock %}

{% set current_page = 'dashboard' %}

{% block content %}
    <!-- æ¬¢è¿åŒºåŸŸ -->
    <section class="card fade-in">
        <div class="card-content" style="text-align: center; padding: 3rem;">
            <h2 style="font-size: 2.5rem; margin-bottom: 1rem; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                æ¬¢è¿ä½¿ç”¨éªŒè¯ç æ¥æ”¶å¹³å°
            </h2>
            <p style="font-size: 1.2rem; color: var(--gray-600); margin-bottom: 2rem;">
                é«˜æ•ˆã€å®‰å…¨ã€ä¾¿æ·çš„ä¸´æ—¶é‚®ç®±éªŒè¯ç ç®¡ç†è§£å†³æ–¹æ¡ˆ
            </p>
            <div style="display: inline-block; padding: 1rem 2rem; background: rgba(102, 126, 234, 0.1); border-radius: 2rem; border: 2px solid var(--primary-color);">
                <span style="font-size: 1.5rem; color: var(--primary-color); font-weight: bold;">
                    ğŸš€ ç³»ç»Ÿè¿è¡Œæ­£å¸¸
                </span>
            </div>
        </div>
    </section>

    <!-- å¿«æ·æ“ä½œ -->
    <section class="card fade-in">
        <div class="card-header">
            <h3 class="card-title">âš¡ å¿«æ·æ“ä½œ</h3>
        </div>
        <div class="card-content">
            <div class="grid grid-4">
                <a href="/emails" class="card" style="padding: 2rem; text-align: center; text-decoration: none; color: inherit;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¬</div>
                    <div style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;">é‚®ç®±ç®¡ç†</div>
                    <div style="color: var(--gray-600);">åˆ›å»ºã€æŸ¥çœ‹å’Œç®¡ç†ä¸´æ—¶é‚®ç®±</div>
                </a>
                <a href="/verification" class="card" style="padding: 2rem; text-align: center; text-decoration: none; color: inherit;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”</div>
                    <div style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;">éªŒè¯ç æŸ¥çœ‹</div>
                    <div style="color: var(--gray-600);">æŸ¥çœ‹æ‰€æœ‰é‚®ç®±çš„éªŒè¯ç è®°å½•</div>
                </a>
                <a href="/stats" class="card" style="padding: 2rem; text-align: center; text-decoration: none; color: inherit;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“Š</div>
                    <div style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;">ç³»ç»Ÿç»Ÿè®¡</div>
                    <div style="color: var(--gray-600);">æŸ¥çœ‹å¹³å°è¿è¡ŒçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯</div>
                </a>
                <a href="/send" class="card" style="padding: 2rem; text-align: center; text-decoration: none; color: inherit;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“¤</div>
                    <div style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;">å‘é€é‚®ä»¶</div>
                    <div style="color: var(--gray-600);">ä½¿ç”¨ä¸´æ—¶é‚®ç®±å‘é€é‚®ä»¶</div>
                </a>
            </div>
        </div>
    </section>

    <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
    <section class="card fade-in">
        <div class="card-header">
            <h3 class="card-title">ğŸ“ˆ ç³»ç»Ÿæ¦‚è§ˆ</h3>
        </div>
        <div class="card-content">
            <div class="grid grid-4">
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary-color); margin-bottom: 0.5rem;" id="totalEmails">--</div>
                    <div style="font-size: 1.1rem; color: var(--gray-600);">æ€»é‚®ç®±æ•°</div>
                    <div class="status-badge status-success" id="emailStatus">æ­£å¸¸</div>
                </div>
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--success-color); margin-bottom: 0.5rem;" id="activeEmails">--</div>
                    <div style="font-size: 1.1rem; color: var(--gray-600);">æ´»è·ƒé‚®ç®±</div>
                    <div class="status-badge status-success" id="activeStatus">æ­£å¸¸</div>
                </div>
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--warning-color); margin-bottom: 0.5rem;" id="totalCodes">--</div>
                    <div style="font-size: 1.1rem; color: var(--gray-600);">éªŒè¯ç æ€»æ•°</div>
                    <div class="status-badge status-success" id="codeStatus">æ­£å¸¸</div>
                </div>
                <div class="card" style="padding: 1.5rem; text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--info-color); margin-bottom: 0.5rem;" id="serverStatus">--</div>
                    <div style="font-size: 1.1rem; color: var(--gray-600);">æœåŠ¡å™¨çŠ¶æ€</div>
                    <div class="status-badge status-success" id="serverStatusBadge">æ­£å¸¸</div>
                </div>
            </div>
        </div>
    </section>

    <!-- æœ€è¿‘æ´»åŠ¨ -->
    <section class="card fade-in">
        <div class="card-header">
            <h3 class="card-title">ğŸ• æœ€è¿‘æ´»åŠ¨</h3>
        </div>
        <div class="card-content">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“‹</div>
                <div class="empty-state-title">æš‚æ— æ´»åŠ¨è®°å½•</div>
                <div class="empty-state-description">ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼Œæ‰€æœ‰åŠŸèƒ½å·¥ä½œæ­£å¸¸</div>
            </div>
        </div>
    </section>

{% endblock %}

{% block extra_scripts %}
<script>
    // é¡µé¢åŠ è½½æ—¶è·å–ç»Ÿè®¡ä¿¡æ¯
    document.addEventListener('DOMContentLoaded', function() {
        loadStats();
        // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
        setInterval(loadStats, 60000);
    });

    async function loadStats() {
        try {
            const response = await fetch('/api/stats');
            const data = await response.json();

            if (response.ok) {
                updateStats(data);
            }
        } catch (error) {
            console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
        }
    }

    function updateStats(data) {
        // æ›´æ–°åŸºç¡€ç»Ÿè®¡
        document.getElementById('totalEmails').textContent = data.total_emails || 0;
        document.getElementById('activeEmails').textContent = data.active_emails || 0;
        document.getElementById('totalCodes').textContent = data.total_codes || 0;

        // æ›´æ–°æœåŠ¡å™¨çŠ¶æ€
        const serverStatus = data.server_status === 'æ­£å¸¸' ? 'âœ…' : 'âŒ';
        document.getElementById('serverStatus').textContent = serverStatus;

        // æ›´æ–°çŠ¶æ€æ ‡ç­¾æ ·å¼
        updateStatusBadge('emailStatus', (data.total_emails || 0) > 0);
        updateStatusBadge('activeStatus', (data.active_emails || 0) > 0);
        updateStatusBadge('codeStatus', (data.total_codes || 0) >= 0);
        updateStatusBadge('serverStatusBadge', data.server_status === 'æ­£å¸¸');
    }

    function updateStatusBadge(elementId, isHealthy) {
        const badge = document.getElementById(elementId);
        if (isHealthy) {
            badge.className = 'status-badge status-success';
            badge.textContent = 'æ­£å¸¸';
        } else {
            badge.className = 'status-badge status-warning';
            badge.textContent = 'æ— æ•°æ®';
        }
    }

</script>
{% endblock %}
